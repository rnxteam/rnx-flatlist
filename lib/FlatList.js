'use strict';var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn');var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _inherits2=require('babel-runtime/helpers/inherits');var _inherits3=_interopRequireDefault(_inherits2);var _extends2=require('babel-runtime/helpers/extends');var _extends3=_interopRequireDefault(_extends2);var _class,_temp,_jsxFileName='src/FlatList.js';var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactNative=require('react-native');var _ViewabilityHelper=require('ViewabilityHelper');var _PureComponent2=require('./PureComponent.js');var _PureComponent3=_interopRequireDefault(_PureComponent2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var MetroListView=require('./MetroListView');var VirtualizedList=require('./VirtualizedList');var invariant=require('fbjs/lib/invariant');var defaultProps=(0,_extends3.default)({},VirtualizedList.defaultProps,{numColumns:1});var FlatList=(_temp=_class=function(_PureComponent){(0,_inherits3.default)(FlatList,_PureComponent);(0,_createClass3.default)(FlatList,[{key:'scrollToEnd',value:function scrollToEnd(params){this._listRef.scrollToEnd(params);}},{key:'scrollToIndex',value:function scrollToIndex(params){this._listRef.scrollToIndex(params);}},{key:'scrollToItem',value:function scrollToItem(params){this._listRef.scrollToItem(params);}},{key:'scrollToOffset',value:function scrollToOffset(params){this._listRef.scrollToOffset(params);}},{key:'recordInteraction',value:function recordInteraction(){this._listRef.recordInteraction();}},{key:'flashScrollIndicators',value:function flashScrollIndicators(){this._listRef.flashScrollIndicators();}},{key:'getScrollResponder',value:function getScrollResponder(){if(this._listRef){return this._listRef.getScrollResponder();}}},{key:'getScrollableNode',value:function getScrollableNode(){if(this._listRef){return this._listRef.getScrollableNode();}}},{key:'setNativeProps',value:function setNativeProps(props){if(this._listRef){this._listRef.setNativeProps(props);}}},{key:'componentWillMount',value:function componentWillMount(){this._checkProps(this.props);}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(nextProps){invariant(nextProps.numColumns===this.props.numColumns,'Changing numColumns on the fly is not supported. Change the key prop on FlatList when '+'changing the number of columns to force a fresh render of the component.');invariant(nextProps.onViewableItemsChanged===this.props.onViewableItemsChanged,'Changing onViewableItemsChanged on the fly is not supported');invariant(nextProps.viewabilityConfig===this.props.viewabilityConfig,'Changing viewabilityConfig on the fly is not supported');invariant(nextProps.viewabilityConfigCallbackPairs===this.props.viewabilityConfigCallbackPairs,'Changing viewabilityConfigCallbackPairs on the fly is not supported');this._checkProps(nextProps);}}]);function FlatList(props){(0,_classCallCheck3.default)(this,FlatList);var _this=(0,_possibleConstructorReturn3.default)(this,(FlatList.__proto__||Object.getPrototypeOf(FlatList)).call(this,props));_this._hasWarnedLegacy=false;_this._virtualizedListPairs=[];_this._captureRef=function(ref){_this._listRef=ref;};_this._getItem=function(data,index){var numColumns=_this.props.numColumns;if(numColumns>1){var ret=[];for(var kk=0;kk<numColumns;kk++){var item=data[index*numColumns+kk];item&&ret.push(item);}return ret;}return data[index];};_this._getItemCount=function(data){return data?Math.ceil(data.length/_this.props.numColumns):0;};_this._keyExtractor=function(items,index){var _this$props=_this.props,keyExtractor=_this$props.keyExtractor,numColumns=_this$props.numColumns;if(numColumns>1){invariant(Array.isArray(items),'FlatList: Encountered internal consistency error, expected each item to consist of an '+'array with 1-%s columns; instead, received a single item.',numColumns);return items.map(function(it,kk){return keyExtractor(it,index*numColumns+kk);}).join(':');}return keyExtractor(items,index);};_this._renderItem=function(info){var _this$props2=_this.props,renderItem=_this$props2.renderItem,numColumns=_this$props2.numColumns,columnWrapperStyle=_this$props2.columnWrapperStyle;if(numColumns>1){var item=info.item,index=info.index;invariant(Array.isArray(item),'Expected array of items with numColumns > 1');return _react2.default.createElement(_reactNative.View,{style:[{flexDirection:'row'},columnWrapperStyle],__source:{fileName:_jsxFileName,lineNumber:588}},item.map(function(it,kk){var element=renderItem({item:it,index:index*numColumns+kk,separators:info.separators});return element&&_react2.default.cloneElement(element,{key:kk});}));}return renderItem(info);};if(_this.props.viewabilityConfigCallbackPairs){_this._virtualizedListPairs=_this.props.viewabilityConfigCallbackPairs.map(function(pair){return{viewabilityConfig:pair.viewabilityConfig,onViewableItemsChanged:_this._createOnViewableItemsChanged(pair.onViewableItemsChanged)};});}else if(_this.props.onViewableItemsChanged){_this._virtualizedListPairs.push({viewabilityConfig:_this.props.viewabilityConfig,onViewableItemsChanged:_this._createOnViewableItemsChanged(_this.props.onViewableItemsChanged)});}return _this;}(0,_createClass3.default)(FlatList,[{key:'_checkProps',value:function _checkProps(props){var getItem=props.getItem,getItemCount=props.getItemCount,horizontal=props.horizontal,legacyImplementation=props.legacyImplementation,numColumns=props.numColumns,columnWrapperStyle=props.columnWrapperStyle,onViewableItemsChanged=props.onViewableItemsChanged,viewabilityConfigCallbackPairs=props.viewabilityConfigCallbackPairs;invariant(!getItem&&!getItemCount,'FlatList does not support custom data formats.');if(numColumns>1){invariant(!horizontal,'numColumns does not support horizontal.');}else{invariant(!columnWrapperStyle,'columnWrapperStyle not supported for single column lists');}if(legacyImplementation){invariant(numColumns===1,'Legacy list does not support multiple columns.');if(!this._hasWarnedLegacy){console.warn('FlatList: Using legacyImplementation - some features not supported and performance '+'may suffer');this._hasWarnedLegacy=true;}}invariant(!(onViewableItemsChanged&&viewabilityConfigCallbackPairs),'FlatList does not support setting both onViewableItemsChanged and '+'viewabilityConfigCallbackPairs.');}},{key:'_pushMultiColumnViewable',value:function _pushMultiColumnViewable(arr,v){var _props=this.props,numColumns=_props.numColumns,keyExtractor=_props.keyExtractor;v.item.forEach(function(item,ii){invariant(v.index!=null,'Missing index!');var index=v.index*numColumns+ii;arr.push((0,_extends3.default)({},v,{item:item,key:keyExtractor(item,index),index:index}));});}},{key:'_createOnViewableItemsChanged',value:function _createOnViewableItemsChanged(onViewableItemsChanged){var _this2=this;return function(info){var numColumns=_this2.props.numColumns;if(onViewableItemsChanged){if(numColumns>1){var changed=[];var viewableItems=[];info.viewableItems.forEach(function(v){return _this2._pushMultiColumnViewable(viewableItems,v);});info.changed.forEach(function(v){return _this2._pushMultiColumnViewable(changed,v);});onViewableItemsChanged({viewableItems:viewableItems,changed:changed});}else{onViewableItemsChanged(info);}}};}},{key:'render',value:function render(){if(this.props.legacyImplementation){return _react2.default.createElement(MetroListView,(0,_extends3.default)({},this.props,{items:this.props.data,ref:this._captureRef,__source:{fileName:_jsxFileName,lineNumber:606}}));}return _react2.default.createElement(VirtualizedList,(0,_extends3.default)({},this.props,{renderItem:this._renderItem,getItem:this._getItem,getItemCount:this._getItemCount,keyExtractor:this._keyExtractor,ref:this._captureRef,viewabilityConfigCallbackPairs:this._virtualizedListPairs,__source:{fileName:_jsxFileName,lineNumber:614}}));}}]);return FlatList;}(_PureComponent3.default),_class.defaultProps=defaultProps,_temp);module.exports=FlatList;